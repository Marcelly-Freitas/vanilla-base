import{t as R}from"./turmaEntityService.service-C-A0ySkN.js";import{r as j}from"./registrationEntity.service-TUR9GVoc.js";import{f as g}from"./frequencyEntity.service-C-dWmfOu.js";import{n as F,a as T}from"./index-Ckh9VWKK.js";import{f as x}from"./index-xJp9Kd2E.js";import"./useLocalstorage-BtQVKKxs.js";let D=!1;function M(l=[],r=null){r&&l.forEach((c,a)=>{const e=document.createElement("form"),m=document.createElement("div"),p=document.createElement("div"),f=document.createElement("div"),b=document.createElement("div"),n=document.createElement("input"),d=document.createElement("input"),o=document.createElement("input"),y=document.createElement("label"),s=document.createElement("label"),h=document.createElement("label");m.textContent=c.aluno_name,m.classList.add("font-bold"),n.setAttribute("type","radio"),n.setAttribute("id","presenca_"+a),n.setAttribute("name","frequency"),n.setAttribute("value","P"),n.classList.add("hidden"),d.setAttribute("type","radio"),d.setAttribute("id","ausencia_"+a),d.setAttribute("name","frequency"),d.setAttribute("value","F"),d.classList.add("hidden"),o.setAttribute("type","radio"),o.setAttribute("id","justificado_"+a),o.setAttribute("name","frequency"),o.setAttribute("value","J"),o.classList.add("hidden"),y.setAttribute("for","presenca_"+a),y.textContent="P",s.setAttribute("for","ausencia_"+a),s.textContent="F",h.setAttribute("for","justificado_"+a),h.textContent="J",p.appendChild(n),p.appendChild(y),f.appendChild(d),f.appendChild(s),b.appendChild(o),b.appendChild(h),e.classList.add("row"),e.setAttribute("data-aluno-id",c.aluno_id),e.setAttribute("data-aluno-name",c.aluno_name),e.setAttribute("data-aluno-cpf",c.aluno_cpf),e.appendChild(m),e.appendChild(p),e.appendChild(f),e.appendChild(b),r.appendChild(e)})}function H(l,r){const c=new Date().toISOString().slice(0,10);return[...l].find(a=>a.data.slice(0,10)==c&&r==a.turma_id)}async function w(){D=!0;const{showNotification:l}=T(),r=document.querySelector(".form-wrapper"),c=document.querySelector(".loading-wrapper"),a=window.location.href.split("/").pop(),{data:e}=await R.getByCode(a),m=document.querySelector("#frequencia-nome"),p=document.querySelector("#frequencia-ano"),f=document.querySelector("#frequencia-responsavel"),b=document.querySelector("#data"),n=r.querySelector("button[type=submit]");m.innerHTML="",p.innerHTML="",f.innerHTML="",b.innerHTML="",m.textContent="Turma: "+e.nome,p.textContent="Período: "+e.semestre,f.textContent="Responsável: "+e.professor,b.textContent="Data: "+new Date().toLocaleDateString();const{data:d}=await j.getAll(),{data:o}=await g.getAll(),y=d.filter(i=>i.turma_id===a&&i.active),s=r.querySelector(".form .body");s.innerHTML="",y.length?M(y,s):(s.textContent="Nenhum aluno disponível",n.setAttribute("disabled","disabled")),c.classList.add("hidden"),r.classList.remove("hidden"),s.querySelectorAll(".row").forEach((i,u)=>{const E=i.getAttribute("data-aluno-id"),L=new Date().toISOString().slice(0,10),S=[...o].find(t=>t.aluno_id===E&&t.data.slice(0,10)==L&&e.id==t.turma_id);if(S){const t=S.status_aluno,A=i.querySelector(`label[for="presenca_${u}"]`),v=i.querySelector(`label[for="ausencia_${u}"]`),_=i.querySelector(`label[for="justificado_${u}"]`);switch(t){case"P":A.click();break;case"F":v.click();break;default:_.click();break}}});const C=H(o,e.id);n.textContent=C?"Atualizar frequência":"Lançar frequência",n.addEventListener("click",async i=>{i.preventDefault(),n.setAttribute("disabled","disabled");const u=[];s.querySelectorAll(".row").forEach(t=>{const A=t.getAttribute("data-aluno-id"),v=t.getAttribute("data-aluno-name"),_=t.getAttribute("data-aluno-cpf"),k=t.querySelectorAll("input[type=radio]"),N=Array.from(k).find(I=>I.checked),P=N?N.value:"F",q={aluno_id:A,aluno_name:v,aluno_cpf:_,turma_id:e.id,turma_name:e.nome,status_aluno:P,data:new Date().toISOString()};q.id=x.string.uuid(),q.created_at=new Date().toISOString(),q.active=!0,u.push(q)});const L=u.map(t=>g.create(t)),S=o.map((t,A)=>g.update(t.id,u[A]));C?await Promise.all(L):await Promise.all(S),l({type:"success",title:"Sucesso",message:C?"Dados atualizados com sucesso":"Dados cadastrados com sucesso"}),F(null,"/turmas/frequencia/lista")})}const U={init(){w(),window.addEventListener("changepage",function(l){D||w()})}};export{U as default};
