import{r as m}from"./registrationEntity.service-TUR9GVoc.js";import{a as w}from"./index-Ckh9VWKK.js";import{u as x}from"./useDOMManager-kq_JSqPb.js";import"./useLocalstorage-BtQVKKxs.js";let q=!1;async function S(){q=!0;const{createCancelRegistrationList:p}=x(),r=document.querySelector(".registration-search-form"),c=document.querySelector(".cancelamento_matricula_wrapper"),f=document.querySelector(".lista-wrapper"),e=document.querySelector(".cancelamento_matricula_empty"),{showNotification:g}=w();r&&c&&r.addEventListener("submit",async A=>{if(A.preventDefault(),document.querySelector(".loading"))return!1;const y=r.querySelector("input[type=search]");if(y){const v=y.value;if(v.length){const o=async()=>{e.innerHTML="",f.innerHTML="",c.classList.add("hidden"),e.classList.remove("hidden");const i=document.createElement("div");i.classList.add("loading"),i.innerHTML="Carregando...",e.append(i);const L=document.createElement("h3");L.textContent="Utilize a pesquisa acima para encontrar aluno";const{data:E}=await m.getAll(),l=[...E].filter(d=>d.aluno_cpf==v);if(!l.length)alert("Nenhum resultado encontrado"),e.innerHTML="",e.append(L);else{const d=[...l].reduce((n,s)=>(n=s.aluno_name,n),""),h=document.querySelector(".cancelamento_matricula .nome_aluno");h.innerHTML="",h.textContent="Aluno: "+d;const C=p(l);C.querySelectorAll("li").forEach(n=>{const s=n.querySelector(".actions"),b=n.getAttribute("data-id"),M=JSON.parse(n.getAttribute("data-active")),t=document.createElement("button");t.textContent="Cancelar matrícula",t.classList.add("btn"),t.classList.add("btn-danger"),t.addEventListener("click",async u=>{u.preventDefault(),t.setAttribute("disabled","disabled"),t.textContent="Carregando...",await m.update(b,{active:!1}),g({type:"success",title:"Sucesso",message:"Matricula cancelada com sucesso"}),o()});const a=document.createElement("button");a.textContent="Ativar matrícula",a.classList.add("btn"),a.classList.add("btn-success"),a.addEventListener("click",async u=>{u.preventDefault(),a.setAttribute("disabled","disabled"),a.textContent="Carregando...",await m.update(b,{active:!0}),g({type:"success",title:"Sucesso",message:"Matricula ativada com sucesso"}),o()}),M?s.appendChild(t):s.appendChild(a)}),f.appendChild(C),c.classList.remove("hidden"),e.classList.add("hidden"),e.innerHTML=""}};o()}}})}const R={init(){S(),window.addEventListener("changepage",function(p){q||S()})}};export{R as default};
